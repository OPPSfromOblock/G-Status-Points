<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gurukul Points Management - GSTATUS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { margin-top: 20px; }
        .tab-content { padding: 20px; }
        .exam-input { display: none; margin-top: 10px; } /* Removed cupboard-action classes */
        .update-message { display: none; margin-top: 10px; }
        h1, h3 { color: #343a40; }
        table { width: 100%; }
        th, td { padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Gurukul Points Management - GSTATUS</h1>
        
        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs" id="gurukulTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-bs-toggle="tab" href="#home" role="tab">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="administration-tab" data-bs-toggle="tab" href="#administration" role="tab">Administration</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="rankings-tab" data-bs-toggle="tab" href="#rankings" role="tab">Rankings</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="responses-tab" data-bs-toggle="tab" href="#responses" role="tab">Responses</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Home Tab -->
            <div class="tab-pane fade show active" id="home" role="tabpanel">
                <h3>Jai Swaminarayan</h3>
                <p><strong>Status:</strong> System Active</p>
                <p><strong>Version:</strong> 1.0</p>
            </div>

            <!-- Administration Tab -->
            <div class="tab-pane fade" id="administration" role="tabpanel">
                <h3>Administration</h3>
                <div class="mb-3">
                    <label for="searchQueryPoints" class="form-label">Search Student by Name, ID, Floor, or Room</label>
                    <input type="text" class="form-control" id="searchQueryPoints" placeholder="Enter name, ID, floor, or room">
                </div>
                <div id="searchResultsPoints" class="mb-3"></div>
                <form id="pointsForm">
                    <h4>Select Positive Action</h4>
                    <select name="positiveAction" class="form-select mb-3" id="positiveAction">
                        <option value="">Select an action</option>
                        <option value="5">Participation in competition (+5)</option>
                        <option value="5">Helping others (+5)</option>
                        <option value="10">Room cleaning competition 1st (+10)</option>
                        <option value="7">Room cleaning competition 2nd (+7)</option>
                        <option value="5">Room cleaning competition 3rd (+5)</option>
                        <option value="15">Winners in competition (+15)</option>
                        <option value="10">Good discipline (+10)</option>
                        <option value="exam">According to percentage (exam)</option>
                    </select>
                    <div class="exam-input" id="examPercentage">
                        <label for="percentageInput" class="form-label">Enter Exam Percentage</label>
                        <input type="number" class="form-control" id="percentageInput" placeholder="e.g., 85" min="0" max="100">
                    </div>
                    <h4>Select Negative Action</h4>
                    <select name="negativeAction" class="form-select mb-3">
                        <option value="">Select an action</option>
                        <option value="-5">No Dress code (-5)</option>
                        <option value="-3">Incomplete homework (-3)</option>
                        <option value="-3">Late from playing bell (-3)</option>
                        <option value="-10">Absent to school (-10)</option>
                        <option value="-7">No room cleaning (-7)</option>
                        <option value="-10">Late for prayer (-10)</option>
                        <option value="-10">Fighting (-10)</option>
                        <option value="-5">Indiscipline in study hour (-5)</option>
                        <option value="-5">Roaming outside (-5)</option>
                        <option value="-10">Not speaking in English (-10)</option>
                        <option value="-10">Late for pooja (-10)</option>
                        <option value="-3">Talking in studying (-3)</option>
                        <option value="-10">No discipline (-10)</option>
                        <option value="-5">Speaking Bad words (-5)</option>
                        <option value="-10">Disobeying in-charges (-10)</option>
                        <option value="-20">Damaging gurukul properties (-20)</option>
                        <option value="-3">No pooja equipment (-3)</option>
                        <option value="-3">No cupboard cleaning (-3)</option>
                    </select>
                    <!-- Removed remarkInput from admin tab -->
                    <button type="submit" class="btn btn-primary">Go</button>
                </form>
                <div class="update-message alert alert-success" id="updateMessage"></div>

                <!-- Removed Cupboard Management section -->
            </div>

            <!-- Rankings Tab -->
            <div class="tab-pane fade" id="rankings" role="tabpanel">
                <h3>Student Rankings</h3>
                <div class="mb-3">
                    <label for="searchQueryRankings" class="form-label">Search Student by Name, ID, Floor, or Room</label>
                    <input type="text" class="form-control" id="searchQueryRankings" placeholder="Enter name, ID, floor, or room">
                </div>
                <div id="searchResultsRankings" class="mb-3"></div>
                <div class="mb-3">
                    <label for="gradeFilter" class="form-label">Filter by Grade</label>
                    <select class="form-select" id="gradeFilter">
                        <option value="all">All Grades</option>
                        <option value="A+">A+</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                    </select>
                </div>
                <button class="btn btn-primary mb-3" id="refreshRankings">Refresh Rankings</button>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Room</th>
                            <th>Floor</th>
                            <th>Total Points</th>
                            <th>Grade</th>
                            <th>Remark</th>
                        </tr>
                    </thead>
                    <tbody id="rankingsTable"></tbody>
                </table>
            </div>

            <!-- Responses Tab -->
            <div class="tab-pane fade" id="responses" role="tabpanel">
                <h3>Response History</h3>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Action</th>
                            <th>Points Changed</th>
                        </tr>
                    </thead>
                    <tbody id="responseTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize student data in localStorage if not present
        const initialStudents = [
            { id: 'AE2389', name: 'VEERAMALLA DHEERAJ', room: '101/1', points: 0, remark: '' },
            { id: 'AE5738', name: 'SOHITH SUBHANG RISHI VATTURI', room: '101/2', points: 0, remark: '' },
            { id: 'AD2352', name: 'BHASWRAJU VIVEK', room: '101/3', points: 0, remark: '' },
            { id: 'AD7711', name: 'SAMUDRALA SRIRAM PRAHARSHA', room: '101/4', points: 0, remark: '' },
            { id: 'AE4945', name: 'SMARAN JASTI', room: '101/5', points: 0, remark: '' },
            { id: 'AD5064', name: 'PABBA SATHVIK', room: '101/6', points: 0, remark: '' },
            { id: 'AD5037', name: 'YERRA MOHAN KARTHIKEYA', room: '101/7', points: 0, remark: '' },
            { id: 'AE7078', name: 'V CHAITANYA SWARWOOP', room: '101/8', points: 0, remark: '' },
            { id: 'AD9505', name: 'LIKHESH BEVARA', room: '101/9', points: 0, remark: '' },
            { id: 'AD4516', name: 'Omkar Swarup Pradhan', room: '101/10', points: 0, remark: '' },
            { id: 'AF4818', name: 'MADHIRE HANRITH', room: '101/11', points: 0, remark: '' },
            { id: 'AF3709', name: 'K RAM CHARAN UTTEJ', room: '101/12', points: 0, remark: '' },
            { id: 'AF3017', name: 'AKULA HARSHA', room: '101/13', points: 0, remark: '' },
            { id: 'AF6178', name: 'K VIBHAS', room: '101/14', points: 0, remark: '' },
            { id: 'AF3618', name: 'VENDI EEKSHITH', room: '101/15', points: 0, remark: '' },
            { id: 'AF8537', name: 'ACHYUTH RAO', room: '101/16', points: 0, remark: '' },
            { id: 'AD8823', name: 'VAIJNATH SHIVKANT MEDGE', room: '102/1', points: 0, remark: '' },
            { id: 'AD8618', name: 'NAGELLI SHISHIR REDDY', room: '102/2', points: 0, remark: '' },
            { id: 'AD9329', name: 'M NIVAS', room: '102/3', points: 0, remark: '' },
            { id: 'AF6700', name: 'PALEPU NAVEEN RAJU', room: '102/4', points: 0, remark: '' },
            { id: 'AE4784', name: 'G CHANDRESH PATEL', room: '102/5', points: 0, remark: '' },
            { id: 'AF4039', name: 'ADITHYA SRINIVAS NAIDU TIRUMALASETTY', room: '102/6', points: 0, remark: '' },
            { id: 'AE2503', name: 'MURTHY TEJASWI MUMMIDAVARAPU', room: '102/7', points: 0, remark: '' },
            { id: 'AF4007', name: 'SHESHAVPURI TANISHQ', room: '102/8', points: 0, remark: '' },
            { id: 'AD8845', name: 'JISHAN GHOSH', room: '102/9', points: 0, remark: '' },
            { id: 'AF3338', name: 'Lolam ganesh', room: '102/10', points: 0, remark: '' },
            { id: 'AF8457', name: 'Shurya Suhas Chavan', room: '102/11', points: 0, remark: '' },
            { id: 'AE0647', name: 'B MANISH', room: '102/12', points: 0, remark: '' },
            { id: 'AF4524', name: 'NIGEL WANGKHEIMAYUM', room: '102/13', points: 0, remark: '' },
            { id: 'AD3355', name: 'Uppala Sai Chandra', room: '102/14', points: 0, remark: '' },
            { id: 'AF6328', name: 'DAMAM BHARATH', room: '102/15', points: 0, remark: '' },
            { id: 'AF4830', name: 'SHRIYASH DATTATRAY GURME', room: '102/16', points: 0, remark: '' },
            { id: 'AF2351', name: 'S MANOCHARAN', room: '103/1', points: 0, remark: '' },
            { id: 'AE9179', name: 'KOUSHIK S', room: '103/2', points: 0, remark: '' },
            { id: 'AE6350', name: 'POSHAL KARUNYA', room: '103/3', points: 0, remark: '' },
            { id: 'AC6389', name: 'GAJULA SRISHANTH', room: '103/4', points: 0, remark: '' },
            { id: 'AE6192', name: 'VADLA SHREE HARI', room: '103/5', points: 0, remark: '' },
            { id: 'AE1176', name: 'ARSHANAPELLI JASHAN RAO', room: '103/7', points: 0, remark: '' },
            { id: 'AE4808', name: 'KODIGANTI KARTHIK', room: '103/8', points: 0, remark: '' },
            { id: 'AF3019', name: 'Khunt Dev', room: '103/9', points: 0, remark: '' },
            { id: 'AF4499', name: 'ASHWATH KATAKAM', room: '103/10', points: 0, remark: '' },
            { id: 'AF2981', name: 'P MADHAN KUMAR', room: '103/12', points: 0, remark: '' },
            { id: 'AE8407', name: 'RAGHAV PATEL', room: '103/13', points: 0, remark: '' },
            { id: 'AD7362', name: 'T SRISHANTH', room: '103/14', points: 0, remark: '' },
            { id: 'AF2877', name: 'BHEEMANGARI DINESH REDDY', room: '103/15', points: 0, remark: '' },
            { id: 'AE6225', name: 'KARRI YASHWANTH SATHYA VENKATA SAI', room: '103/16', points: 0, remark: '' },
            { id: 'AD5701', name: 'DODDELA PRANAY RAJ', room: '104/1', points: 0, remark: '' },
            { id: 'AF7855', name: 'SEETHAPATHI TANISH', room: '104/3', points: 0, remark: '' },
            { id: 'AF3798', name: 'SHOURYA AGARWAL', room: '104/5', points: 0, remark: '' },
            { id: 'AE8422', name: 'NITYA PATEL', room: '104/6', points: 0, remark: '' },
            { id: 'AE5783', name: 'ISHAAN MUTHYALA', room: '104/8', points: 0, remark: '' },
            { id: 'AD8775', name: 'SABBANI ROHITH KUMAR', room: '104/9', points: 0, remark: '' },
            { id: 'AE5112', name: 'SACHIN KUMAR', room: '104/10', points: 0, remark: '' },
            { id: 'AF3160', name: 'YOHAAN JAISWAL', room: '104/11', points: 0, remark: '' },
            { id: 'AF2450', name: 'NYATHKALA KARTHIKEYA', room: '104/12', points: 0, remark: '' },
            { id: 'AD9845', name: 'DHAIRYA PATEL', room: '104/13', points: 0, remark: '' },
            { id: 'AF3631', name: 'AMITH ARJUNE', room: '104/14', points: 0, remark: '' },
            { id: 'AF3385', name: 'KONDIKANTI NANI SAGAR', room: '104/15', points: 0, remark: '' },
            { id: 'AF4984', name: 'PALASH BHOWMIK', room: '104/16', points: 0, remark: '' },
            { id: 'AF4727', name: 'P JEEVAN NAYAK', room: '105/1', points: 0, remark: '' },
            { id: 'AE1879', name: 'AKULA GEETH VARUN', room: '105/2', points: 0, remark: '' },
            { id: 'AF5926', name: 'ALUVALA SRI SHIVA SAHISHNU', room: '105/3', points: 0, remark: '' },
            { id: 'AD2257', name: 'JAPA SHASHANK REDDY', room: '105/4', points: 0, remark: '' },
            { id: 'AF2303', name: 'CHARABUDDI NEHANTH REDDY', room: '105/5', points: 0, remark: '' },
            { id: 'AD7577', name: 'Singuluri Leela Pavan Kumar', room: '105/6', points: 0, remark: '' },
            { id: 'AF4304', name: 'KOKKALAKONDA SHIVA SREEKAR', room: '105/7', points: 0, remark: '' },
            { id: 'AH0015', name: 'Rudra Pratap Nayak', room: '105/8', points: 0, remark: '' },
            { id: 'AE5810', name: 'BANOTH VIVEK VARSHITH', room: '105/9', points: 0, remark: '' },
            { id: 'AF3258', name: 'Pottipally Rushil Reddy', room: '105/10', points: 0, remark: '' },
            { id: 'AF4992', name: 'ATMAKURI MANOHAR', room: '105/11', points: 0, remark: '' },
            { id: 'AF3092', name: 'KASANAGOTTU AASHISH', room: '105/12', points: 0, remark: '' },
            { id: 'AE5504', name: 'ANURAG SINGH', room: '105/13', points: 0, remark: '' },
            { id: 'AF2492', name: 'GUNDAGANI HRISHITH', room: '105/14', points: 0, remark: '' },
            { id: 'AD8910', name: 'PALLE ADHARSH REDDY', room: '105/15', points: 0, remark: '' },
            { id: 'AF7534', name: 'Akula dhanush', room: '105/16', points: 0, remark: '' },
            { id: 'AE9724', name: 'ILA SHRITHAN', room: '106/1', points: 0, remark: '' },
            { id: 'AF1688', name: 'GUDA VASTALYA VISHNU VARDHAN REDDY', room: '106/2', points: 0, remark: '' },
            { id: 'AF4216', name: 'KRITANU ANAND', room: '106/3', points: 0, remark: '' },
            { id: 'AE1619', name: 'MOPURU REVANTH REDDY', room: '106/4', points: 0, remark: '' },
            { id: 'AF5574', name: 'DAMANNAGARI SHOURYA DEEP REDDY', room: '106/5', points: 0, remark: '' },
            { id: 'AF2002', name: 'SONTI REDDY PRITAM REDDY', room: '106/6', points: 0, remark: '' },
            { id: 'AD9200', name: 'D.NARAYANA REDDY', room: '106/7', points: 0, remark: '' },
            { id: 'AE5774', name: 'PENMETSA AMAN VARMA', room: '106/8', points: 0, remark: '' },
            { id: 'AE2973', name: 'V JASWANTH SRI MANIKANTA', room: '106/9', points: 0, remark: '' },
            { id: 'AF3022', name: 'Diksh Devda', room: '106/10', points: 0, remark: '' },
            { id: 'AF3831', name: 'KOLAGANI MANIKANTHA', room: '106/11', points: 0, remark: '' },
            { id: 'AD4481', name: 'PEDDINTI MANI SHANKAR', room: '106/12', points: 0, remark: '' },
            { id: 'AE6337', name: 'AMGOTH REVANTH', room: '106/13', points: 0, remark: '' },
            { id: 'AF4203', name: 'ALLAM ROHITH KUMAR REDDY', room: '106/14', points: 0, remark: '' },
            { id: 'AF2447', name: 'KONDA ABHI RAM', room: '106/15', points: 0, remark: '' },
            { id: 'AE6358', name: 'BADRI VARSHITH PATEL', room: '106/16', points: 0, remark: '' },
            { id: 'AF2956', name: 'AMAND YATIN', room: '107/1', points: 0, remark: '' },
            { id: 'AF6519', name: 'GONUGUNTLA ANISH CHOWDARY', room: '107/2', points: 0, remark: '' },
            { id: 'AE2110', name: 'DIWAN SURYA SHREYAS', room: '107/3', points: 0, remark: '' },
            { id: 'AF3003', name: 'Kottu Hrusheekesha', room: '107/4', points: 0, remark: '' },
            { id: 'AE8150', name: 'KUMMATI DEEPAK REDDY', room: '107/5', points: 0, remark: '' },
            { id: 'AE5946', name: 'DONDI HARSHITH', room: '107/6', points: 0, remark: '' },
            { id: 'AF2955', name: 'SURUKUNTA SHRITHAN REDDY', room: '107/7', points: 0, remark: '' },
            { id: 'AF3460', name: 'Ramagiri Sravan Bhargav', room: '107/8', points: 0, remark: '' },
            { id: 'AF3091', name: 'BIKSHAMAIAH PODILA', room: '107/9', points: 0, remark: '' },
            { id: 'AE1489', name: 'PARTH PIYUSH PATEL', room: '107/10', points: 0, remark: '' },
            { id: 'AF7140', name: 'GAJERA DHRUVKUMAR KRISHNAKANT', room: '107/11', points: 0, remark: '' },
            { id: 'AE2358', name: 'GOURAV SINGH', room: '107/12', points: 0, remark: '' },
            { id: 'AF6518', name: 'MOHIT YOGESH KATHIRIA', room: '107/13', points: 0, remark: '' },
            { id: 'AF3321', name: 'BEDUDHURU THAXILESWARA REDDY', room: '107/14', points: 0, remark: '' },
            { id: 'AF4923', name: 'RENTIKOTA JANAKI RAM', room: '107/15', points: 0, remark: '' },
            { id: 'AD2038', name: 'PINNINTI UDAY HARSHA', room: '108/1', points: 0, remark: '' },
            { id: 'AE8928', name: 'PREM KUMAR PATIL', room: '108/2', points: 0, remark: '' },
            { id: 'AF1539', name: 'MUKUL MALPANI', room: '108/3', points: 0, remark: '' },
            { id: 'AE5906', name: 'DHARMA MUKESH SAVALIA', room: '108/5', points: 0, remark: '' },
            { id: 'AF6412', name: 'PEDAKOTA SHREEHANS', room: '108/7', points: 0, remark: '' },
            { id: 'AD6750', name: 'ATHARVA DUBEY', room: '108/8', points: 0, remark: '' },
            { id: 'AE2752', name: 'KOTHAPALLY PRANEETH REDDY', room: '108/9', points: 0, remark: '' },
            { id: 'AE2354', name: 'BHUVANESHWAR POLICE PATEL', room: '108/10', points: 0, remark: '' },
            { id: 'AF3078', name: 'SAI SATVIK BORULE', room: '108/11', points: 0, remark: '' },
            { id: 'AF4502', name: 'ALLURI SHARATH CHANDRA', room: '108/12', points: 0, remark: '' },
            { id: 'AD8257', name: 'Aarush Jigneshkumar Kevadiya', room: '108/13', points: 0, remark: '' },
            { id: 'AE8360', name: 'GUMUDALA VARSHITH', room: '108/14', points: 0, remark: '' },
            { id: 'AE9623', name: 'NILAY AMIT LANDGE', room: '108/15', points: 0, remark: '' },
            { id: 'AE1222', name: 'RUDRESH ARUN ASHTURE', room: '108/16', points: 0, remark: '' },
            { id: 'AF4849', name: 'KHETANI ANSH PARAG', room: '109/1', points: 0, remark: '' },
            { id: 'AE2250', name: 'KILARI.VENKATA SAI HARSHA', room: '109/2', points: 0, remark: '' },
            { id: 'AD5180', name: 'SANGANI HARSHIT RAKESHBHAI', room: '109/3', points: 0, remark: '' },
            { id: 'AD4896', name: 'AKASH MITTAL', room: '109/4', points: 0, remark: '' },
            { id: 'AD6316', name: 'RAUNAK VERMA', room: '109/5', points: 0, remark: '' },
            { id: 'AF3810', name: 'TIRTH KUMAR PATEL', room: '109/6', points: 0, remark: '' },
            { id: 'AE5788', name: 'G LOHITH REDDY', room: '109/7', points: 0, remark: '' },
            { id: 'AE4551', name: 'RNS PURUSHOTTAM', room: '109/8', points: 0, remark: '' },
            { id: 'AE1064', name: 'K BHUVAN', room: '109/9', points: 0, remark: '' },
            { id: 'AE9000', name: 'PETHANI HET SHAILESHBHAI', room: '109/10', points: 0, remark: '' },
            { id: 'AF6467', name: 'RUPAPARA DIVY MILAN BHAI', room: '109/11', points: 0, remark: '' },
            { id: 'AE5755', name: 'ARADLA ABHINAV REDDY', room: '109/12', points: 0, remark: '' },
            { id: 'AE5727', name: 'PANDURI SOMA MRUDUL', room: '109/13', points: 0, remark: '' },
            { id: 'AE8919', name: 'ADITYA POONDRU', room: '109/14', points: 0, remark: '' },
            { id: 'AF5873', name: 'Alakh Tiwari', room: '109/15', points: 0, remark: '' },
            { id: 'AF4919', name: 'RUDRA MANIDHAR', room: '109/16', points: 0, remark: '' },
            { id: 'AE4941', name: 'PANAV GUPTA', room: '110/1', points: 0, remark: '' },
            { id: 'AD4924', name: 'Dodda Sri Sai Prateek Kumar', room: '110/2', points: 0, remark: '' },
            { id: 'AE4751', name: 'RATHLA VIVEK', room: '110/3', points: 0, remark: '' },
            { id: 'AF6468', name: 'KHATRA RENISH MEHULBHAI', room: '110/4', points: 0, remark: '' },
            { id: 'AE5743', name: 'DARSH JITENDRA PATEL', room: '110/5', points: 0, remark: '' },
            { id: 'AE8255', name: 'Bhanderi Preet Rameshbhai', room: '110/6', points: 0, remark: '' },
            { id: 'AE6369', name: 'MANTHRI VINAYAK', room: '110/7', points: 0, remark: '' },
            { id: 'AE0519', name: 'AYUSH MALPANI', room: '110/9', points: 0, remark: '' },
            { id: 'AE6043', name: 'SWAYAM MOHTA', room: '110/10', points: 0, remark: '' },
            { id: 'AF5955', name: 'YASH SHAW', room: '110/11', points: 0, remark: '' },
            { id: 'AC7228', name: 'GULLA SHIVA KUMAR', room: '110/12', points: 0, remark: '' },
            { id: 'AC3582', name: 'CHINNABABAU BAJARAG SOMESH', room: '110/13', points: 0, remark: '' },
            { id: 'AF7113', name: 'DEVANI SHREY RAJESH BHAI', room: '110/14', points: 0, remark: '' },
            { id: 'AD2140', name: 'KOTA SAI AARUSH', room: '110/15', points: 0, remark: '' },
            { id: 'AF4985', name: 'GUJJULA SHRIYAN REDDY', room: '110/16', points: 0, remark: '' },
            { id: 'AE2449', name: 'HARSH PATEL', room: '111/1', points: 0, remark: '' },
            { id: 'AE4890', name: 'AYUSH NEMANI', room: '111/2', points: 0, remark: '' },
            { id: 'AC3178', name: 'GOLLAPALLY MEGHANATH REDDY', room: '111/3', points: 0, remark: '' },
            { id: 'AE6387', name: 'CH SHIVA KESHAVA', room: '111/4', points: 0, remark: '' },
            { id: 'AE0652', name: 'DURGAM VIJAYA SRIKAR', room: '111/5', points: 0, remark: '' },
            { id: 'AF3847', name: 'Y TRINADH', room: '111/6', points: 0, remark: '' },
            { id: 'AF4197', name: 'HARSHIT PATEL', room: '114/16', points: 0, remark: '' }
        ];

        if (!localStorage.getItem('students')) {
            localStorage.setItem('students', JSON.stringify(initialStudents));
        }
        if (!localStorage.getItem('responseHistory')) {
            localStorage.setItem('responseHistory', JSON.stringify([]));
        }

        let students = JSON.parse(localStorage.getItem('students')) || [];
        let responseHistory = JSON.parse(localStorage.getItem('responseHistory')) || [];

        // Removed availableRooms and initializeCupboardDropdowns as cupboard management is removed.

        // Search functionality for points and rankings
        function handleSearch(inputId, resultsId) {
            document.getElementById(inputId).addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const results = document.getElementById(resultsId);
                results.innerHTML = '';
                if (query) {
                    const filteredStudents = students.filter(student => {
                        const floor = student.room.split('/')[0];
                        return student.name.toLowerCase().includes(query) || 
                               student.id.toLowerCase().includes(query) || 
                               student.room.toLowerCase().includes(query) || 
                               floor.includes(query);
                    });
                    if (filteredStudents.length) {
                        results.innerHTML = '<h5>Matching Students:</h5>';
                        filteredStudents.forEach(student => {
                            results.innerHTML += `
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="${inputId === 'searchQueryPoints' ? 'selectedStudents' : 'selectedRankings'}" value="${student.id}" id="${inputId}_${student.id}">
                                    <label class="form-check-label" for="${inputId}_${student.id}">
                                        ${student.name} (${student.id}, Room: ${student.room}, Points: ${student.points})
                                    </label>
                                </div>
                            `;
                        });
                    } else {
                        results.innerHTML = '<p>No students found.</p>';
                    }
                }
            });
        }

        // Show/hide exam percentage input
        document.getElementById('positiveAction').addEventListener('change', function() {
            const examInput = document.getElementById('examPercentage');
            examInput.style.display = this.value === 'exam' ? 'block' : 'none';
        });

        // Handle points form submission
        document.getElementById('pointsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const selectedStudentIds = Array.from(document.querySelectorAll('input[name="selectedStudents"]:checked')).map(input => input.value);
            const positiveAction = document.getElementById('positiveAction').value;
            const negativeAction = document.querySelector('[name="negativeAction"]').value;
            const percentageInput = document.getElementById('percentageInput').value;
            // Removed remark from admin form submission
            const updateMessage = document.getElementById('updateMessage');

            if (!selectedStudentIds.length) {
                updateMessage.classList.remove('alert-success');
                updateMessage.classList.add('alert-danger');
                updateMessage.textContent = 'Please select at least one student.';
                updateMessage.style.display = 'block';
                setTimeout(() => updateMessage.style.display = 'none', 3000);
                return;
            }

            let points = 0;
            let actionText = '';
            if (positiveAction && negativeAction) {
                updateMessage.classList.remove('alert-success');
                updateMessage.classList.add('alert-danger');
                updateMessage.textContent = 'Please select only one action (positive or negative).';
                updateMessage.style.display = 'block';
                setTimeout(() => updateMessage.style.display = 'none', 3000);
                return;
            } else if (positiveAction) {
                if (positiveAction === 'exam') {
                    const percentage = parseInt(percentageInput);
                    if (isNaN(percentage) || percentage < 0 || percentage > 100) {
                        updateMessage.classList.remove('alert-success');
                        updateMessage.classList.add('alert-danger');
                        updateMessage.textContent = 'Please enter a valid percentage (0-100).';
                        updateMessage.style.display = 'block';
                        setTimeout(() => updateMessage.style.display = 'none', 3000);
                        return;
                    }
                    points = percentage >= 90 ? 20 : percentage >= 80 ? 15 : percentage >= 70 ? 10 : 5;
                    actionText = `Exam Percentage (${percentage}%)`;
                } else {
                    points = parseInt(positiveAction);
                    actionText = document.querySelector(`#positiveAction option[value="${positiveAction}"]`).text;
                }
            } else if (negativeAction) {
                points = parseInt(negativeAction);
                actionText = document.querySelector(`select[name="negativeAction"] option[value="${negativeAction}"]`).text;
            } else {
                updateMessage.classList.remove('alert-success');
                updateMessage.classList.add('alert-danger');
                updateMessage.textContent = 'Please select an action.';
                updateMessage.style.display = 'block';
                setTimeout(() => updateMessage.style.display = 'none', 3000);
                return;
            }

            const now = new Date();
            const date = now.toLocaleDateString('en-GB');
            const time = now.toLocaleTimeString('en-GB');

            selectedStudentIds.forEach(studentId => {
                const student = students.find(s => s.id === studentId);
                if (student) {
                    student.points += points;
                    // Removed remark update from admin form submission
                    responseHistory.push({
                        date,
                        time,
                        studentId,
                        name: student.name,
                        action: actionText,
                        pointsChanged: points
                    });
                }
            });

            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('responseHistory', JSON.stringify(responseHistory));

            updateMessage.classList.remove('alert-danger');
            updateMessage.classList.add('alert-success');
            updateMessage.textContent = `Points updated for ${selectedStudentIds.length} student(s): ${points > 0 ? '+' : ''}${points} points each.`; // Removed remark from message
            updateMessage.style.display = 'block';
            setTimeout(() => updateMessage.style.display = 'none', 3000);

            document.getElementById('pointsForm').reset();
            document.getElementById('examPercentage').style.display = 'none';
            document.getElementById('searchResultsPoints').innerHTML = '';
            document.getElementById('searchQueryPoints').value = '';
            refreshRankings();
        });

        // Removed cupboard form submission handler and related functions.

        // Handle remark update from rankings table
        function updateRemark(studentId, newRemark) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.remark = newRemark;
                localStorage.setItem('students', JSON.stringify(students));
                // No need to refresh rankings immediately, as the input field already shows the change
                // If you want a confirmation message, you can add it here.
            }
        }

        // Refresh rankings
        function refreshRankings() {
            const rankingsTable = document.getElementById('rankingsTable');
            const gradeFilter = document.getElementById('gradeFilter').value;
            let sortedStudents = [...students].sort((a, b) => b.points - a.points);

            // Assign grades based on rank
            sortedStudents.forEach((student, index) => {
                if (index < 10) {
                    student.assignedGrade = 'A+';
                } else if (index < 10 + 30) {
                    student.assignedGrade = 'A';
                } else if (index < 10 + 30 + 30) {
                    student.assignedGrade = 'B';
                } else if (index < 10 + 30 + 30 + 30) {
                    student.assignedGrade = 'C';
                } else {
                    student.assignedGrade = 'D';
                }
            });

            // Filter students by selected grade
            let filteredStudents = sortedStudents;
            if (gradeFilter !== 'all') {
                filteredStudents = sortedStudents.filter(student => student.assignedGrade === gradeFilter);
            }

            rankingsTable.innerHTML = '';
            filteredStudents.forEach((student, index) => {
                const floor = student.room.split('/')[0];
                rankingsTable.innerHTML += `
                    <tr>
                        <td>${sortedStudents.indexOf(student) + 1}</td> <!-- Display original rank -->
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.room}</td>
                        <td>${floor}</td>
                        <td>${student.points}</td>
                        <td>${student.assignedGrade}</td>
                        <td>
                            <input type="text" class="form-control" value="${student.remark || ''}" onchange="updateRemark('${student.id}', this.value)">
                        </td>
                    </tr>
                `;
            });
        }

        // Refresh response history
        function refreshResponses() {
            const responseTable = document.getElementById('responseTable');
            responseTable.innerHTML = '';
            responseHistory.forEach(response => {
                responseTable.innerHTML += `
                    <tr>
                        <td>${response.date}</td>
                        <td>${response.time}</td>
                        <td>${response.studentId}</td>
                        <td>${response.name}</td>
                        <td>${response.action}</td>
                        <td>${response.pointsChanged}</td>
                    </tr>
                `;
            });
        }

        // Initialize
        handleSearch('searchQueryPoints', 'searchResultsPoints');
        handleSearch('searchQueryRankings', 'searchResultsRankings');
        document.getElementById('refreshRankings').addEventListener('click', refreshRankings);
        document.getElementById('gradeFilter').addEventListener('change', refreshRankings); // Add event listener for grade filter
        // Removed initializeCupboardDropdowns call
        refreshRankings();
        refreshResponses();
    </script>
</body>
</html>
